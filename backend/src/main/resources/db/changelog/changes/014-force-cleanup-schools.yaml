databaseChangeLog:
  - changeSet:
      id: 014-force-cleanup-schools
      author: drissman
      changes:
        # 1. Delete Invoices linked to these schools (via booking -> school? or invoice -> school?)
        # Since invoices are usually linked to bookings, and bookings to schools, deleting bookings should trigger cascade if setup.
        # But to be safe, let's look for direct links if any or expect cascade.
        # For now, let's assume cascade or manual delete if needed.
        # Let's delete generic entities first.

        # Delete Bookings
        - sql:
            sql: "DELETE FROM bookings WHERE school_id NOT IN ('11111111-1111-1111-1111-111111111111', '22222222-2222-2222-2222-222222222222', '33333333-3333-3333-3333-333333333333')"

        # Delete Offers (Cascade usually works here, but explicit is safer)
        - sql:
            sql: "DELETE FROM offers WHERE school_id NOT IN ('11111111-1111-1111-1111-111111111111', '22222222-2222-2222-2222-222222222222', '33333333-3333-3333-3333-333333333333')"

        # Delete Availabilities
        - sql:
            sql: "DELETE FROM availabilities WHERE school_id NOT IN ('11111111-1111-1111-1111-111111111111', '22222222-2222-2222-2222-222222222222', '33333333-3333-3333-3333-333333333333')"

        # Delete Reviews
        - sql:
            sql: "DELETE FROM reviews WHERE school_id NOT IN ('11111111-1111-1111-1111-111111111111', '22222222-2222-2222-2222-222222222222', '33333333-3333-3333-3333-333333333333')"

        # Delete Users directly connected to these schools (School Admins)
        - sql:
            sql: "DELETE FROM users WHERE school_id IS NOT NULL AND school_id NOT IN ('11111111-1111-1111-1111-111111111111', '22222222-2222-2222-2222-222222222222', '33333333-3333-3333-3333-333333333333')"

        # Finally, Delete the Schools
        - sql:
            sql: "DELETE FROM schools WHERE id NOT IN ('11111111-1111-1111-1111-111111111111', '22222222-2222-2222-2222-222222222222', '33333333-3333-3333-3333-333333333333')"
