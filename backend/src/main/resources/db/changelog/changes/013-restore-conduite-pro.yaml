databaseChangeLog:
  - changeSet:
      id: 013-restore-conduite-pro
      author: drissman
      changes:
        # Pre-cleanup to avoid Duplicate Key Error if 012 failed or school exists
        - sql: "DELETE FROM invoices WHERE booking_id IN (SELECT id FROM bookings WHERE school_id = '22222222-2222-2222-2222-222222222222')"
        - sql: "DELETE FROM reviews WHERE school_id = '22222222-2222-2222-2222-222222222222'"
        - sql: "DELETE FROM availabilities WHERE school_id = '22222222-2222-2222-2222-222222222222'"
        - sql: "DELETE FROM offers WHERE school_id = '22222222-2222-2222-2222-222222222222'"
        - sql: "DELETE FROM bookings WHERE school_id = '22222222-2222-2222-2222-222222222222'"
        - sql: "DELETE FROM users WHERE school_id = '22222222-2222-2222-2222-222222222222'"
        - sql: "DELETE FROM schools WHERE id = '22222222-2222-2222-2222-222222222222'"

        # 1. Restore Conduite Pro Douala (ID: 2222...)
        - insert:
            tableName: schools
            columns:
              - column:
                  name: id
                  value: "22222222-2222-2222-2222-222222222222"
              - column:
                  name: name
                  value: "Conduite Pro Douala"
              - column:
                  name: description
                  value: "Formation rapide et efficace au cœur de Douala."
              - column:
                  name: address
                  value: "45 Rue de la Joie, Akwa"
              - column:
                  name: city
                  value: "Douala"
              - column:
                  name: phone
                  value: "+237 677 987 654"
              - column:
                  name: email
                  value: "info@conduitepro.cm"
              - column:
                  name: rating
                  value: 4.5
              - column:
                  name: image_url
                  value: "/assets/school-2.jpg"
        
        # 2. Restore its offer
        - insert:
            tableName: offers
            columns:
              - column:
                  name: school_id
                  value: "22222222-2222-2222-2222-222222222222"
              - column:
                  name: name
                  value: "Formation Accélérée"
              - column:
                  name: description
                  value: "Permis B en 2 semaines"
              - column:
                  name: price
                  value: 350000
              - column:
                  name: hours
                  value: 30

  - changeSet:
      id: 013-delete-test-schools
      author: drissman
      changes:
        # 3. Delete all schools that are NOT in the demo set (1111, 2222, 3333)
        - delete:
            tableName: schools
            where: "id NOT IN ('11111111-1111-1111-1111-111111111111', '22222222-2222-2222-2222-222222222222', '33333333-3333-3333-3333-333333333333')"
